<!DOCTYPE html>
<html lang="es">
<head>
       <link rel="icon" type="image/png" href="img/logo.png">
    <link rel="apple-touch-icon" href="img/logo.png">
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="2hbghMg_sHTSPhxlcHJ1haJpCEc1dp_fOy6qRl47WIM" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA DE GESTION DE FACTURAS Y TONELADAS</title>
        <link rel="icon" type="image/png" href="../img/logo.png">
    <link rel="apple-touch-icon" href="../img/logo.png">
    <link rel="icon" href="../img/logo.png" type="image/jpeg">
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- jsPDF para exportar a PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <link rel="icon" href="img/logo.png" type="image/jpeg">
    <style>
        /* ESTILOS GENERALES */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --tonelada: #8e44ad;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* PANTALLA DE LOGIN */
        .login-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            padding: 30px 20px;
            max-width: 400px;
            width: 95%;
            text-align: center;
            margin-top: 10vh;
        }
        
        .login-container h1 {
            color: var(--dark);
            margin-bottom: 25px;
            font-size: 1.5rem;
        }
        
        .login-container i {
            font-size: 40px;
            color: var(--secondary);
            margin-bottom: 15px;
        }
        
        /* TARJETAS Y FORMULARIOS */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 20px 15px;
            margin-bottom: 20px;
        }
        
        h1, h2, h3 {
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        h1 {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 20px;
            color: white;
            padding: 0 10px;
        }
        
        h2 {
            font-size: 1.4rem;
            border-bottom: 2px solid var(--light);
            padding-bottom: 8px;
        }
        
        /* FORMULARIOS */
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        /* BOTONES */
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover, .btn-primary:active {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-tonelada {
            background: var(--tonelada);
            color: white;
        }
        
        .btn-pendiente {
            background: var(--danger);
            color: white;
        }
        
        .btn-cancelado {
            background: var(--success);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .btn-full {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .btn-auto {
            width: auto;
        }
        
        /* BOTONES EN LINEA */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .button-group .btn {
            flex: 1;
        }
        
        /* TABLAS - OPTIMIZADA PARA M√ìVIL */
        .table-container {
            overflow-x: auto;
            margin-top: 15px;
            -webkit-overflow-scrolling: touch;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th, td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }
        
        th {
            background: var(--primary);
            color: white;
            font-weight: 600;
            position: sticky;
            left: 0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .tonelada-table th {
            background: var(--tonelada);
        }
        
        /* MODALES - OPTIMIZADOS PARA M√ìVIL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
            padding: 10px;
        }
        
        .modal-content {
            background: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 12px;
            width: 95%;
            max-width: 500px;
            box-sizing: border-box;
        }
        
        /* GRID ADAPTATIVO */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        /* ESTADOS */
        .hidden {
            display: none !important;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            font-size: 16px;
        }
        
        .alert {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* HEADER DE MES - OPTIMIZADO PARA M√ìVIL */
        .mes-header {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .mes-title {
            color: #2c3e50;
            margin: 0;
            font-size: 1.2rem;
        }
        
        .mes-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .totales {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }
        
        .total-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .total-main {
            font-weight: bold;
            font-size: 1em;
            border-top: 1px dashed #ccc;
            padding-top: 8px;
            margin-top: 8px;
        }
        
        /* MEJORAS ESPEC√çFICAS PARA M√ìVIL */
        .mobile-optimized {
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        /* BOTONES T√ÅCTILES M√ÅS GRANDES EN M√ìVIL */
        @media (max-width: 768px) {
            .btn {
                min-height: 44px;
            }
            
            input, select {
                font-size: 16px; /* Previene zoom en iOS */
            }
            
            .button-group {
                flex-direction: column;
            }
        }
        
        /* ESTILOS PARA PANTALLAS MUY PEQUE√ëAS */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .card {
                padding: 15px 10px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            h2 {
                font-size: 1.2rem;
            }
            
            .mes-title {
                font-size: 1.1rem;
            }
            
            .btn-sm {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .modal-content {
                padding: 15px;
                margin: 5% auto;
            }
        }
        
        /* ESTILOS PARA TABLETS Y PANTALLAS M√ÅS GRANDES */
        @media (min-width: 768px) {
            .form-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
            
            .mes-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .mes-actions {
                justify-content: flex-end;
            }
        }
        
        /* MEJORA DE SCROLL EN M√ìVIL */
        .scroll-mobile {
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
        }
    </style>
</head>
<body class="mobile-optimized">
    <!-- Pantalla de Login -->
    <div id="loginScreen" class="login-container">
        <i class="fas fa-lock"></i>
        <h1>Acceso al Sistema</h1>
        <div class="form-group">
            <label for="passwordInput">Contrase√±a:</label>
            <input type="password" id="passwordInput" placeholder="Ingresa la contrase√±a">
        </div>
        <button class="btn btn-primary btn-full" id="btnLogin">
            <i class="fas fa-sign-in-alt"></i> Ingresar
        </button>
        <div id="loginError" class="alert alert-error hidden" style="margin-top: 15px;">
            Contrase√±a incorrecta. Intenta nuevamente.
        </div>
    </div>
    
    <!-- Sistema de Facturas (oculto inicialmente) -->
    <div id="appContainer" class="container hidden scroll-mobile">
        <h1><i class="fas fa-file-invoice-dollar"></i> Sistema de Gesti√≥n de Facturas y Toneladas</h1>
        
        <!-- Mensajes de alerta -->
        <div id="alertContainer"></div>
        
        <!-- Formulario para Nueva Factura -->
        <div class="card">
            <h2><i class="fas fa-plus-circle"></i> Nueva Factura</h2>
            
            <div class="form-group">
                <label for="mes"><i class="fas fa-calendar-alt"></i> Mes de Facturaci√≥n</label>
                <input type="month" id="mes" required>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="nro">N√∫mero de Orden</label>
                    <input type="number" id="nro" min="1" placeholder="Se asignar√° autom√°ticamente" readonly>
                    <small>Se asigna autom√°ticamente seg√∫n la posici√≥n cronol√≥gica</small>
                </div>
                
                <div class="form-group">
                    <label for="empresa">Empresa</label>
                    <input type="text" id="empresa" placeholder="Nombre de la empresa" required>
                </div>
                
                <div class="form-group">
                    <label for="fecha">Fecha de Factura</label>
                    <input type="date" id="fecha" required>
                </div>
                
                <div class="form-group">
                    <label for="nroFactura">N√∫mero de Factura</label>
                    <input type="text" id="nroFactura" placeholder="N√∫mero completo" required>
                </div>
                
                <div class="form-group">
                    <label for="monto">Monto (Bs)</label>
                    <input type="number" id="monto" step="0.01" placeholder="0.00" required>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="btnAgregar">
                    <i class="fas fa-plus"></i> Agregar Factura
                </button>
                <button class="btn btn-tonelada" id="btnAbrirModalTonelada">
                    <i class="fas fa-weight-hanging"></i> Agregar Tonelada
                </button>
            </div>
        </div>
        
        <!-- Lista de Facturas y Toneladas -->
        <div class="card">
            <h2><i class="fas fa-list"></i> Registros del Mes</h2>
            <div id="listaRegistros">
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Cargando registros...
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para Agregar Tonelada -->
    <div id="modalTonelada" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-weight-hanging"></i> Agregar Nueva Tonelada</h3>
            
            <div class="form-group">
                <label for="mesTonelada"><i class="fas fa-calendar-alt"></i> Mes</label>
                <input type="month" id="mesTonelada" required>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="nroTonelada">N√∫mero de Orden</label>
                    <input type="number" id="nroTonelada" min="1" placeholder="Se asignar√° autom√°ticamente" readonly>
                    <small>Se asigna autom√°ticamente seg√∫n la posici√≥n cronol√≥gica</small>
                </div>
                
                <div class="form-group">
                    <label for="fechaTonelada">Fecha</label>
                    <input type="date" id="fechaTonelada" required>
                </div>
                
                <div class="form-group">
                    <label for="cantidadTonelada">Cantidad (Toneladas)</label>
                    <input type="number" id="cantidadTonelada" step="0.01" placeholder="0.00" required>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn" onclick="cerrarModal('modalTonelada')">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                <button class="btn btn-tonelada" id="btnAgregarTonelada">
                    <i class="fas fa-plus"></i> Agregar Tonelada
                </button>
            </div>
        </div>
    </div>
    
    <!-- Modal para Confirmar Eliminaci√≥n -->
    <div id="modalEliminar" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-trash"></i> Confirmar Eliminaci√≥n</h3>
            <p id="modalEliminarTexto">¬øEst√°s seguro de que deseas eliminar este registro?</p>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-auto" onclick="cerrarModal('modalEliminar')">Cancelar</button>
                <button class="btn btn-danger btn-auto" id="btnConfirmarEliminar">Eliminar</button>
            </div>
        </div>
    </div>
    
    <!-- Modal para Confirmar Cancelaci√≥n -->
    <div id="modalCancelacion" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-check-circle"></i> Confirmar Cancelaci√≥n</h3>
            <p id="modalCancelacionTexto">¬øEst√°s seguro de que este mes ha sido cancelado?</p>
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-auto" onclick="cerrarModal('modalCancelacion')">Cancelar</button>
                <button class="btn btn-success btn-auto" id="btnConfirmarCancelacion">S√≠, Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Exportar -->
    <div id="modalExportar" class="modal">
        <div class="modal-content">
            <h3><i class="fas fa-download"></i> Exportar Registros</h3>
            <p id="modalExportarTexto">Selecciona el formato para descargar:</p>
            <div style="display: flex; gap: 10px; justify-content: center; margin: 20px 0; flex-direction: column;">
                <button class="btn btn-danger btn-full" id="btnExportarPDF">
                    <i class="fas fa-file-pdf"></i> Exportar a PDF
                </button>
                <button class="btn btn-primary btn-full" id="btnExportarWord">
                    <i class="fas fa-file-word"></i> Exportar a Word
                </button>
            </div>
            <div style="margin-top: 15px; text-align: center;">
                <button class="btn btn-auto" onclick="cerrarModal('modalExportar')">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // CONFIGURACI√ìN DE FIREBASE
        // =============================================
        
        const firebaseConfig = {
            apiKey: "AIzaSyBokBK_PYvpvpFX6t0GW4sDLr31QdVklp8",
            authDomain: "sistemas-facturas.firebaseapp.com",
            projectId: "sistemas-facturas",
            storageBucket: "sistemas-facturas.firebasestorage.app",
            messagingSenderId: "802542240199",
            appId: "1:802542240199:web:71d2ba2b68b4b42d2e99e2"
        };
        
        // Inicializar Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log('‚úÖ Firebase inicializado correctamente');
        } catch (error) {
            console.error('‚ùå Error inicializando Firebase:', error);
            mostrarAlerta('Error al conectar con la base de datos', 'error');
        }
        
        const db = firebase.firestore();
        const { jsPDF } = window.jspdf;
        
        // =============================================
        // VARIABLES GLOBALES
        // =============================================
        let facturas = [];
        let toneladas = [];
        let registroAEliminar = null;
        let mesACancelar = null;
        let mesAExportar = null;
        const PASSWORD = "Churqui123"; // Contrase√±a de acceso
        
        // =============================================
        // FUNCIONES DE AUTENTICACI√ìN
        // =============================================
        
        // Verificar contrase√±a
        function verificarPassword() {
            const passwordInput = document.getElementById('passwordInput').value;
            const loginError = document.getElementById('loginError');
            
            if (passwordInput === PASSWORD) {
                // Contrase√±a correcta, mostrar la aplicaci√≥n
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                inicializarAplicacion();
            } else {
                // Contrase√±a incorrecta
                loginError.classList.remove('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordInput').focus();
            }
        }
        
        // Inicializar la aplicaci√≥n despu√©s del login
        function inicializarAplicacion() {
            // Establecer fecha actual por defecto
            const hoy = new Date().toISOString().split('T')[0];
            document.getElementById('fecha').value = hoy;
            document.getElementById('fechaTonelada').value = hoy;
            
            // Establecer mes actual por defecto
            const mesActual = new Date().toISOString().slice(0, 7);
            document.getElementById('mes').value = mesActual;
            document.getElementById('mesTonelada').value = mesActual;
            
            // Actualizar n√∫mero de orden al cambiar fecha o mes
            document.getElementById('fecha').addEventListener('change', actualizarNumeroOrden);
            document.getElementById('mes').addEventListener('change', actualizarNumeroOrden);
            document.getElementById('fechaTonelada').addEventListener('change', actualizarNumeroOrdenTonelada);
            document.getElementById('mesTonelada').addEventListener('change', actualizarNumeroOrdenTonelada);
            
            // Event listeners
            document.getElementById('btnAgregar').addEventListener('click', agregarFactura);
            document.getElementById('btnAbrirModalTonelada').addEventListener('click', function() {
                document.getElementById('modalTonelada').style.display = 'block';
            });
            document.getElementById('btnAgregarTonelada').addEventListener('click', agregarTonelada);
            document.getElementById('btnConfirmarEliminar').addEventListener('click', function() {
                if (registroAEliminar) {
                    eliminarRegistro(registroAEliminar);
                }
            });
            document.getElementById('btnConfirmarCancelacion').addEventListener('click', function() {
                if (mesACancelar) {
                    cancelarMes(mesACancelar);
                }
            });
            
            // Event listeners para exportar
            document.getElementById('btnExportarPDF').addEventListener('click', function() {
                if (mesAExportar) {
                    exportarAPDF(mesAExportar);
                }
            });
            document.getElementById('btnExportarWord').addEventListener('click', function() {
                if (mesAExportar) {
                    exportarAWord(mesAExportar);
                }
            });
            
            // Cargar datos al iniciar
            cargarFacturas();
            cargarToneladas();
            actualizarNumeroOrden();
            actualizarNumeroOrdenTonelada();
            
            // Cerrar modales al hacer clic fuera
            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('modalEliminar')) {
                    cerrarModal('modalEliminar');
                }
                if (event.target === document.getElementById('modalCancelacion')) {
                    cerrarModal('modalCancelacion');
                }
                if (event.target === document.getElementById('modalExportar')) {
                    cerrarModal('modalExportar');
                }
                if (event.target === document.getElementById('modalTonelada')) {
                    cerrarModal('modalTonelada');
                }
            });
        }
        
        // =============================================
        // FUNCIONES PRINCIPALES
        // =============================================
        
        // Mostrar alertas
        function mostrarAlerta(mensaje, tipo = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alertClass = tipo === 'success' ? 'alert-success' : 'alert-error';
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass}`;
            alertDiv.innerHTML = `
                <strong>${tipo === 'success' ? '√âxito!' : 'Error!'}</strong> ${mensaje}
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; font-size: 20px; cursor: pointer;">√ó</button>
            `;
            
            alertContainer.appendChild(alertDiv);
            
            // Auto-eliminar despu√©s de 5 segundos
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.remove();
                }
            }, 5000);
        }
        
        // Cargar facturas desde Firebase
        async function cargarFacturas() {
            try {
                const snapshotFacturas = await db.collection('facturas').orderBy('timestamp', 'desc').get();
                facturas = [];
                
                snapshotFacturas.forEach(doc => {
                    const data = doc.data();
                    facturas.push({
                        id: doc.id,
                        tipo: 'factura',
                        ...data
                    });
                });
                
                console.log('‚úÖ Facturas cargadas:', facturas.length);
                mostrarRegistros();
                
            } catch (error) {
                console.error('‚ùå Error cargando facturas:', error);
                mostrarAlerta('Error al cargar las facturas: ' + error.message, 'error');
            }
        }
        
        // Cargar toneladas desde Firebase
        async function cargarToneladas() {
            try {
                const snapshotToneladas = await db.collection('toneladas').orderBy('timestamp', 'desc').get();
                toneladas = [];
                
                snapshotToneladas.forEach(doc => {
                    const data = doc.data();
                    toneladas.push({
                        id: doc.id,
                        tipo: 'tonelada',
                        ...data
                    });
                });
                
                console.log('‚úÖ Toneladas cargadas:', toneladas.length);
                mostrarRegistros();
                
            } catch (error) {
                console.error('‚ùå Error cargando toneladas:', error);
                mostrarAlerta('Error al cargar las toneladas: ' + error.message, 'error');
            }
        }
        
        // Mostrar registros (facturas + toneladas) en tablas separadas
        function mostrarRegistros() {
            const contenedor = document.getElementById('listaRegistros');
            
            if (facturas.length === 0 && toneladas.length === 0) {
                contenedor.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #666;">
                        <i class="fas fa-inbox" style="font-size: 40px; margin-bottom: 15px;"></i>
                        <h3>No hay registros</h3>
                        <p>Agrega tu primer registro usando los formularios superiores</p>
                    </div>
                `;
                return;
            }
            
            // Agrupar registros por mes
            const facturasPorMes = {};
            const toneladasPorMes = {};
            
            facturas.forEach(factura => {
                if (!facturasPorMes[factura.mes]) {
                    facturasPorMes[factura.mes] = {
                        facturas: [],
                        cancelado: false
                    };
                }
                facturasPorMes[factura.mes].facturas.push(factura);
            });
            
            toneladas.forEach(tonelada => {
                if (!toneladasPorMes[tonelada.mes]) {
                    toneladasPorMes[tonelada.mes] = [];
                }
                toneladasPorMes[tonelada.mes].push(tonelada);
            });
            
            let html = '';
            
            // Ordenar meses de m√°s reciente a m√°s antiguo
            const mesesFacturas = Object.keys(facturasPorMes).sort().reverse();
            const mesesToneladas = Object.keys(toneladasPorMes).sort().reverse();
            const todosMeses = [...new Set([...mesesFacturas, ...mesesToneladas])].sort().reverse();
            
            todosMeses.forEach(mes => {
                const datosMes = facturasPorMes[mes] || { facturas: [], cancelado: false };
                const facturasDelMes = datosMes.facturas || [];
                const toneladasDelMes = toneladasPorMes[mes] || [];
                
                // Ordenar por fecha (m√°s antigua primero)
                facturasDelMes.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
                toneladasDelMes.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
                
                // Reasignar n√∫meros de orden seg√∫n posici√≥n cronol√≥gica
                facturasDelMes.forEach((factura, index) => {
                    factura.nro = index + 1;
                });
                toneladasDelMes.forEach((tonelada, index) => {
                    tonelada.nro = index + 1;
                });
                
                // Calcular totales
                const totalFacturas = facturasDelMes.reduce((sum, factura) => sum + parseFloat(factura.monto), 0);
                const totalToneladas = toneladasDelMes.reduce((sum, tonelada) => sum + parseFloat(tonelada.cantidad), 0);
                const seisPorciento = totalFacturas * 0.06;
                const totalGeneral = seisPorciento;
                
                html += `
                    <div class="mes-group" style="margin-bottom: 25px; border: 2px solid #eee; border-radius: 10px; padding: 15px;">
                        <div class="mes-header">
                            <h3 class="mes-title">${formatearMes(mes)}</h3>
                            <div class="mes-actions">
                                ${datosMes.cancelado ? 
                                    `<button class="btn btn-cancelado btn-sm" disabled>
                                        <i class="fas fa-check-circle"></i> Cancelado
                                    </button>` : 
                                    `<button class="btn btn-pendiente btn-sm" onclick="confirmarCancelacion('${mes}')">
                                        <i class="fas fa-money-bill-wave"></i> Pendiente
                                    </button>`
                                }
                                <button class="btn btn-info btn-sm" onclick="toggleDetalles('${mes}')">
                                    <i class="fas fa-list"></i> Detalles
                                </button>
                                <button class="btn btn-success btn-sm" onclick="mostrarModalExportar('${mes}')">
                                    <i class="fas fa-download"></i> Descargar
                                </button>
                            </div>
                        </div>
                        
                        <div class="totales">
                            <div class="total-line">
                                <span>Total Facturas:</span>
                                <span><strong>${formatearMoneda(totalFacturas)}</strong></span>
                            </div>
                            <div class="total-line">
                                <span>Total Toneladas:</span>
                                <span><strong>${totalToneladas.toFixed(2)} Tn</strong></span>
                            </div>
                            <div class="total-line">
                                <span>6% sobre el total:</span>
                                <span>${formatearMoneda(seisPorciento)}</span>
                            </div>
                            <div class="total-line total-main">
                                <span>TOTAL GENERAL:</span>
                                <span>${formatearMoneda(totalGeneral)}</span>
                            </div>
                        </div>
                        
                        <div id="detalles-${mes}" class="hidden">
                `;
                
                // Tabla de Toneladas (primero)
                if (toneladasDelMes.length > 0) {
                    html += `
                        <h4 style="margin: 20px 0 10px 0; color: var(--tonelada);">
                            <i class="fas fa-weight-hanging"></i> Toneladas
                        </h4>
                        <div class="table-container">
                            <table class="tonelada-table">
                                <thead>
                                    <tr>
                                        <th>Nro</th>
                                        <th>Fecha</th>
                                        <th>Cantidad (Tn)</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    toneladasDelMes.forEach(tonelada => {
                        html += `
                            <tr>
                                <td>${tonelada.nro}</td>
                                <td>${formatearFecha(tonelada.fecha)}</td>
                                <td style="font-weight: bold;">${tonelada.cantidad}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm" onclick="confirmarEliminar('${tonelada.id}', '${tonelada.nro}', '${mes}', 'tonelada')">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
                
                // Tabla de Facturas (despu√©s)
                if (facturasDelMes.length > 0) {
                    html += `
                        <h4 style="margin: 20px 0 10px 0; color: var(--secondary);">
                            <i class="fas fa-file-invoice"></i> Facturas
                        </h4>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nro</th>
                                        <th>Empresa</th>
                                        <th>Fecha</th>
                                        <th>N¬∞ Factura</th>
                                        <th>Monto (Bs)</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    facturasDelMes.forEach(factura => {
                        html += `
                            <tr>
                                <td>${factura.nro}</td>
                                <td>${factura.empresa}</td>
                                <td>${formatearFecha(factura.fecha)}</td>
                                <td>${factura.nroFactura}</td>
                                <td style="font-weight: bold;">${formatearMoneda(factura.monto)}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm" onclick="confirmarEliminar('${factura.id}', '${factura.nro}', '${mes}', 'factura')">
                                        <i class="fas fa-trash"></i> Eliminar
                                    </button>
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            contenedor.innerHTML = html;
        }
        
        // Alternar visibilidad de detalles
        function toggleDetalles(mes) {
            const detalles = document.getElementById(`detalles-${mes}`);
            detalles.classList.toggle('hidden');
        }
        
        // Agregar nueva factura
        async function agregarFactura() {
            const mes = document.getElementById('mes').value;
            const nro = document.getElementById('nro').value;
            const empresa = document.getElementById('empresa').value;
            const fecha = document.getElementById('fecha').value;
            const nroFactura = document.getElementById('nroFactura').value;
            const monto = document.getElementById('monto').value;
            
            // Validaciones
            if (!mes || !nro || !empresa || !fecha || !nroFactura || !monto) {
                mostrarAlerta('Por favor, completa todos los campos', 'error');
                return;
            }
            
            if (parseInt(nro) <= 0) {
                mostrarAlerta('El n√∫mero de orden debe ser mayor a cero', 'error');
                return;
            }
            
            if (parseFloat(monto) <= 0) {
                mostrarAlerta('El monto debe ser mayor a cero', 'error');
                return;
            }
            
            try {
                // Mostrar loading
                const btnAgregar = document.getElementById('btnAgregar');
                const originalText = btnAgregar.innerHTML;
                btnAgregar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
                btnAgregar.disabled = true;
                
                const nuevaFactura = {
                    nro: parseInt(nro),
                    empresa: empresa.trim(),
                    fecha: fecha,
                    nroFactura: nroFactura.trim(),
                    monto: parseFloat(monto),
                    mes: mes,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                console.log('üìù Guardando factura:', nuevaFactura);
                
                // Guardar en Firebase
                await db.collection('facturas').add(nuevaFactura);
                
                // Limpiar formulario
                document.getElementById('empresa').value = '';
                document.getElementById('nroFactura').value = '';
                document.getElementById('monto').value = '';
                
                // Actualizar n√∫mero de orden
                await actualizarNumeroOrden();
                
                // Recargar lista
                await cargarFacturas();
                
                mostrarAlerta('Factura agregada correctamente!');
                
            } catch (error) {
                console.error('‚ùå Error agregando factura:', error);
                mostrarAlerta('Error al agregar la factura: ' + error.message, 'error');
            } finally {
                // Restaurar bot√≥n
                const btnAgregar = document.getElementById('btnAgregar');
                btnAgregar.innerHTML = '<i class="fas fa-plus"></i> Agregar Factura';
                btnAgregar.disabled = false;
            }
        }
        
        // Agregar nueva tonelada
        async function agregarTonelada() {
            const mes = document.getElementById('mesTonelada').value;
            const nro = document.getElementById('nroTonelada').value;
            const fecha = document.getElementById('fechaTonelada').value;
            const cantidad = document.getElementById('cantidadTonelada').value;
            
            // Validaciones
            if (!mes || !nro || !fecha || !cantidad) {
                mostrarAlerta('Por favor, completa todos los campos', 'error');
                return;
            }
            
            if (parseInt(nro) <= 0) {
                mostrarAlerta('El n√∫mero de orden debe ser mayor a cero', 'error');
                return;
            }
            
            if (parseFloat(cantidad) <= 0) {
                mostrarAlerta('La cantidad debe ser mayor a cero', 'error');
                return;
            }
            
            try {
                // Mostrar loading
                const btnAgregar = document.getElementById('btnAgregarTonelada');
                const originalText = btnAgregar.innerHTML;
                btnAgregar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Guardando...';
                btnAgregar.disabled = true;
                
                const nuevaTonelada = {
                    nro: parseInt(nro),
                    fecha: fecha,
                    cantidad: parseFloat(cantidad),
                    mes: mes,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                console.log('‚öñÔ∏è Guardando tonelada:', nuevaTonelada);
                
                // Guardar en Firebase
                await db.collection('toneladas').add(nuevaTonelada);
                
                // Limpiar formulario
                document.getElementById('cantidadTonelada').value = '';
                
                // Actualizar n√∫mero de orden
                await actualizarNumeroOrdenTonelada();
                
                // Recargar lista
                await cargarToneladas();
                
                // Cerrar modal
                cerrarModal('modalTonelada');
                
                mostrarAlerta('Tonelada agregada correctamente!');
                
            } catch (error) {
                console.error('‚ùå Error agregando tonelada:', error);
                mostrarAlerta('Error al agregar la tonelada: ' + error.message, 'error');
            } finally {
                // Restaurar bot√≥n
                const btnAgregar = document.getElementById('btnAgregarTonelada');
                btnAgregar.innerHTML = '<i class="fas fa-plus"></i> Agregar Tonelada';
                btnAgregar.disabled = false;
            }
        }
        
        // Eliminar registro (factura o tonelada)
        async function eliminarRegistro(datos) {
            try {
                const { id, tipo } = datos;
                if (tipo === 'factura') {
                    await db.collection('facturas').doc(id).delete();
                    await cargarFacturas();
                } else {
                    await db.collection('toneladas').doc(id).delete();
                    await cargarToneladas();
                }
                cerrarModal('modalEliminar');
                mostrarAlerta('Registro eliminado correctamente');
            } catch (error) {
                console.error('‚ùå Error eliminando registro:', error);
                mostrarAlerta('Error al eliminar el registro: ' + error.message, 'error');
            }
        }
        
        // Marcar mes como cancelado
        async function cancelarMes(mes) {
            try {
                // En una implementaci√≥n real, aqu√≠ guardar√≠as el estado en Firebase
                // Por ahora solo cambiamos el estado localmente
                mostrarAlerta(`El mes ${formatearMes(mes)} ha sido marcado como cancelado`);
                cerrarModal('modalCancelacion');
                // Recargar para mostrar el cambio
                await cargarFacturas();
                await cargarToneladas();
            } catch (error) {
                console.error('‚ùå Error cancelando mes:', error);
                mostrarAlerta('Error al cancelar el mes: ' + error.message, 'error');
            }
        }
        
        // =============================================
        // FUNCIONES DE EXPORTACI√ìN
        // =============================================
        
        // Mostrar modal para exportar
        function mostrarModalExportar(mes) {
            mesAExportar = mes;
            document.getElementById('modalExportarTexto').textContent = 
                `Exportar registros de ${formatearMes(mes)}`;
            document.getElementById('modalExportar').style.display = 'block';
        }
        
        // Exportar a PDF
        function exportarAPDF(mes) {
            const facturasDelMes = facturas.filter(f => f.mes === mes).sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
            const toneladasDelMes = toneladas.filter(t => t.mes === mes).sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
            
            const nombreMes = formatearMes(mes);
            const totalFacturas = facturasDelMes.reduce((sum, factura) => sum + parseFloat(factura.monto), 0);
            const totalToneladas = toneladasDelMes.reduce((sum, tonelada) => sum + parseFloat(tonelada.cantidad), 0);
            const seisPorciento = totalFacturas * 0.06;
            const totalGeneral =  seisPorciento;
            
            const doc = new jsPDF();
            
            // T√≠tulo
            doc.setFontSize(18);
            doc.text(`Registros del Mes: ${nombreMes}`, 14, 15);
            
            // Tabla de Toneladas
            if (toneladasDelMes.length > 0) {
                doc.setFontSize(14);
                doc.text('Toneladas:', 14, 30);
                
                const tableColumnToneladas = ["Nro", "Fecha", "Cantidad (Tn)"];
                const tableRowsToneladas = [];
                
                toneladasDelMes.forEach((tonelada, index) => {
                    const toneladaData = [
                        index + 1,
                        formatearFecha(tonelada.fecha),
                        tonelada.cantidad
                    ];
                    tableRowsToneladas.push(toneladaData);
                });
                
                doc.autoTable({
                    head: [tableColumnToneladas],
                    body: tableRowsToneladas,
                    startY: 35,
                    theme: 'grid',
                    styles: { fontSize: 10 },
                    headStyles: { fillColor: [142, 68, 173] }
                });
            }
            
            // Tabla de Facturas
            let startY = toneladasDelMes.length > 0 ? doc.lastAutoTable.finalY + 10 : 35;
            
            if (facturasDelMes.length > 0) {
                doc.setFontSize(14);
                doc.text('Facturas:', 14, startY);
                
                const tableColumnFacturas = ["Nro", "Empresa", "Fecha", "N¬∞ Factura", "Monto (Bs)"];
                const tableRowsFacturas = [];
                
                facturasDelMes.forEach((factura, index) => {
                    const facturaData = [
                        index + 1,
                        factura.empresa,
                        formatearFecha(factura.fecha),
                        factura.nroFactura,
                        formatearMoneda(factura.monto)
                    ];
                    tableRowsFacturas.push(facturaData);
                });
                
                doc.autoTable({
                    head: [tableColumnFacturas],
                    body: tableRowsFacturas,
                    startY: startY + 5,
                    theme: 'grid',
                    styles: { fontSize: 10 },
                    headStyles: { fillColor: [44, 62, 80] }
                });
            }
            
            // A√±adir totales - TONELADAS PRIMERO
            const finalY = doc.lastAutoTable ? doc.lastAutoTable.finalY + 10 : startY + 10;
            doc.setFontSize(12);
            doc.text(`Total Toneladas: ${totalToneladas.toFixed(2)} Tn`, 14, finalY);
            doc.text(`Total Facturas: ${formatearMoneda(totalFacturas)}`, 14, finalY + 10);
            doc.text(`6% sobre el total: ${formatearMoneda(seisPorciento)}`, 14, finalY + 20);
            doc.setFontSize(14);
            doc.text(`TOTAL GENERAL: ${formatearMoneda(totalGeneral)}`, 14, finalY + 35);
            
            // Guardar PDF
            doc.save(`registros_${mes}.pdf`);
            mostrarAlerta('PDF generado correctamente');
            cerrarModal('modalExportar');
        }
        
        // Exportar a Word
        function exportarAWord(mes) {
            const facturasDelMes = facturas.filter(f => f.mes === mes).sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
            const toneladasDelMes = toneladas.filter(t => t.mes === mes).sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
            
            const nombreMes = formatearMes(mes);
            const totalFacturas = facturasDelMes.reduce((sum, factura) => sum + parseFloat(factura.monto), 0);
            const totalToneladas = toneladasDelMes.reduce((sum, tonelada) => sum + parseFloat(tonelada.cantidad), 0);
            const seisPorciento = totalFacturas * 0.06;
            const totalGeneral = seisPorciento;
            
            let tableHTML = `
                <html xmlns:o="urn:schemas-microsoft-com:office:office" 
                      xmlns:w="urn:schemas-microsoft-com:office:word" 
                      xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                    <meta charset="utf-8">
                    <title>Registros ${nombreMes}</title>
                    <style>
                        body { font-family: Arial, sans-serif; }
                        table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
                        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                        .tonelada th { background-color: #8e44ad; color: white; }
                        .factura th { background-color: #2c3e50; color: white; }
                        .total { font-weight: bold; margin-top: 20px; }
                        h2 { color: #2c3e50; }
                    </style>
                </head>
                <body>
                    <h1>Registros del Mes: ${nombreMes}</h1>
            `;
            
            // Tabla de Toneladas
            if (toneladasDelMes.length > 0) {
                tableHTML += `
                    <h2>Toneladas</h2>
                    <table class="tonelada">
                        <tr>
                            <th>Nro</th>
                            <th>Fecha</th>
                            <th>Cantidad (Tn)</th>
                        </tr>
                `;
                
                toneladasDelMes.forEach((tonelada, index) => {
                    tableHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${formatearFecha(tonelada.fecha)}</td>
                            <td>${tonelada.cantidad}</td>
                        </tr>
                    `;
                });
                
                tableHTML += `</table>`;
            }
            
            // Tabla de Facturas
            if (facturasDelMes.length > 0) {
                tableHTML += `
                    <h2>Facturas</h2>
                    <table class="factura">
                        <tr>
                            <th>Nro</th>
                            <th>Empresa</th>
                            <th>Fecha</th>
                            <th>N¬∞ Factura</th>
                            <th>Monto (Bs)</th>
                        </tr>
                `;
                
                facturasDelMes.forEach((factura, index) => {
                    tableHTML += `
                        <tr>
                            <td>${index + 1}</td>
                            <td>${factura.empresa}</td>
                            <td>${formatearFecha(factura.fecha)}</td>
                            <td>${factura.nroFactura}</td>
                            <td>${formatearMoneda(factura.monto)}</td>
                        </tr>
                    `;
                });
                
                tableHTML += `</table>`;
            }
            
            // Totales - TONELADAS PRIMERO
            tableHTML += `
                    <div class="total">
                        <p>Total Toneladas: ${totalToneladas.toFixed(2)} Tn</p>
                        <p>Total Facturas: ${formatearMoneda(totalFacturas)}</p>
                        <p>6% sobre el total: ${formatearMoneda(seisPorciento)}</p>
                        <p><strong>TOTAL GENERAL: ${formatearMoneda(totalGeneral)}</strong></p>
                    </div>
                </body>
                </html>
            `;
            
            // Crear blob y descargar
            const blob = new Blob([tableHTML], { type: 'application/msword' });
            const link = document.createElement('a');
            
            link.href = URL.createObjectURL(blob);
            link.download = `registros_${mes}.doc`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            mostrarAlerta('Documento Word generado correctamente');
            cerrarModal('modalExportar');
        }
        
        // =============================================
        // FUNCIONES UTILITARIAS
        // =============================================
        
        // Actualizar n√∫mero de orden autom√°ticamente para facturas
        async function actualizarNumeroOrden() {
            const mes = document.getElementById('mes').value;
            const fecha = document.getElementById('fecha').value;
            
            if (mes && fecha) {
                // Obtener facturas del mes seleccionado
                const facturasDelMes = facturas.filter(f => f.mes === mes);
                
                if (facturasDelMes.length > 0) {
                    // Ordenar por fecha (m√°s antigua primero)
                    facturasDelMes.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
                    
                    // Encontrar la posici√≥n donde insertar la nueva factura
                    const fechaNueva = new Date(fecha);
                    let posicion = 1;
                    
                    for (let i = 0; i < facturasDelMes.length; i++) {
                        const fechaExistente = new Date(facturasDelMes[i].fecha);
                        if (fechaNueva < fechaExistente) {
                            break;
                        }
                        posicion = i + 2; // +2 porque empieza en 1 y sumamos 1 m√°s
                    }
                    
                    document.getElementById('nro').value = posicion;
                } else {
                    // Si no hay facturas en este mes, empezar desde 1
                    document.getElementById('nro').value = 1;
                }
            }
        }
        
        // Actualizar n√∫mero de orden autom√°ticamente para toneladas
        async function actualizarNumeroOrdenTonelada() {
            const mes = document.getElementById('mesTonelada').value;
            const fecha = document.getElementById('fechaTonelada').value;
            
            if (mes && fecha) {
                // Obtener toneladas del mes seleccionado
                const toneladasDelMes = toneladas.filter(t => t.mes === mes);
                
                if (toneladasDelMes.length > 0) {
                    // Ordenar por fecha (m√°s antigua primero)
                    toneladasDelMes.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
                    
                    // Encontrar la posici√≥n donde insertar la nueva tonelada
                    const fechaNueva = new Date(fecha);
                    let posicion = 1;
                    
                    for (let i = 0; i < toneladasDelMes.length; i++) {
                        const fechaExistente = new Date(toneladasDelMes[i].fecha);
                        if (fechaNueva < fechaExistente) {
                            break;
                        }
                        posicion = i + 2; // +2 porque empieza en 1 y sumamos 1 m√°s
                    }
                    
                    document.getElementById('nroTonelada').value = posicion;
                } else {
                    // Si no hay toneladas en este mes, empezar desde 1
                    document.getElementById('nroTonelada').value = 1;
                }
            }
        }
        
        // Formatear fecha (ej: "2024-01-15" -> "15/01/2024")
        function formatearFecha(fecha) {
            const [anio, mes, dia] = fecha.split('-');
            return `${dia}/${mes}/${anio}`;
        }
        
        // Formatear mes (ej: "2024-01" -> "Enero 2024")
        function formatearMes(mes) {
            const [anio, mesNum] = mes.split('-');
            const meses = [
                'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
            ];
            return `${meses[parseInt(mesNum) - 1]} ${anio}`;
        }
        
        // Formatear moneda - MODIFICADO: "Bs" despu√©s del n√∫mero
        function formatearMoneda(monto) {
            return new Intl.NumberFormat('es-BO', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(monto) + '.-';
        }
        
        // Funciones de modales
        function confirmarEliminar(id, nro, mes, tipo) {
            registroAEliminar = { id, tipo };
            const tipoTexto = tipo === 'tonelada' ? 'tonelada' : 'factura';
            document.getElementById('modalEliminarTexto').textContent = 
                `¬øEst√°s seguro de que deseas eliminar la ${tipoTexto} #${nro} del mes ${formatearMes(mes)}?`;
            document.getElementById('modalEliminar').style.display = 'block';
        }
        
        function confirmarCancelacion(mes) {
            mesACancelar = mes;
            document.getElementById('modalCancelacionTexto').textContent = 
                `¬øEst√°s seguro de que el mes ${formatearMes(mes)} ha sido cancelado?`;
            document.getElementById('modalCancelacion').style.display = 'block';
        }
        
        function cerrarModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'modalEliminar') registroAEliminar = null;
            if (modalId === 'modalTonelada') {
                // Limpiar formulario al cerrar
                document.getElementById('cantidadTonelada').value = '';
            }
        }
        
        // =============================================
        // INICIALIZACI√ìN
        // =============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Event listener para el bot√≥n de login
            document.getElementById('btnLogin').addEventListener('click', verificarPassword);
            
            // Permitir login con Enter
            document.getElementById('passwordInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    verificarPassword();
                }
            });
            
            // Enfocar el campo de contrase√±a al cargar
            document.getElementById('passwordInput').focus();
        });
        
        // Funciones globales
        window.cerrarModal = cerrarModal;
        window.confirmarEliminar = confirmarEliminar;
        window.confirmarCancelacion = confirmarCancelacion;
        window.toggleDetalles = toggleDetalles;
        window.mostrarModalExportar = mostrarModalExportar;
        window.exportarAPDF = exportarAPDF;
        window.exportarAWord = exportarAWord;
    </script>
</body>
</html>








